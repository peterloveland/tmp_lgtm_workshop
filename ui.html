<!--    THIS IS THE UI OF THE FIGMA PLUGIN.
        IT CONNECTS TO THE OPENAI API.
        WHEN WE RECEIVE A MESSAGE FROM THE BACK-END, WE CAN USE IT TO UPDATE THE UI.
        WE UPDATE THE FIGMA UI BY SENDING MESSAGES TO CODE.TS like: "parent.postMessage({ pluginMessage: { type: 'INSERT MESSAGE HERE AS A STRING' } }, '*')"
-->

<style>
  .ui-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    font-family: "Inter", sans-serif;
  }

  #parsed-response {
    color: gray;
    font-size: 12px;
    border-top: 1px solid lightgray;
    padding-top: 12px;
  }
</style>

<div class="ui-container">
  <textarea id="prompt-text">Generate content for a sample GitHub issue about React</textarea>
  <button id="submit">Submit</button>
  <button id="get-component-details">get-component-details</button>
  <button id="ping">Ping</button>
  <pre id="parsed-response">API Response will appear here</pre>

</div>

<script>
  // Listen for messages from the back-end
  onmessage = (event) => {
    const { type, message } = event.data.pluginMessage

    // If we receive an event of type "pong", show an alert.
    if (type === 'pong') {
      alert("Pong!")
    }

    if (type === 'parsed-response') {
      document.getElementById('parsed-response').innerText = message ? JSON.stringify(message, null, 5) : 'No response'
    }

    // here we listen to the message from the back-end. This is looking for a message with the type "update-ui"
    if (type === 'update-ui') {
      console.log('Received message from back-end:', type)
    }
  }

  // CLICK HANDLERS GO HERE:

  document.getElementById('submit').onclick = () => {
    const promptText = document.getElementById('prompt-text')?.value || ''
    parent.postMessage({ pluginMessage: { type: 'generate-ai', prompt: promptText } }, '*')
  }

  document.getElementById('ping').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'ping' } }, '*')
  }

  document.getElementById('get-component-details').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'get-component-details' } }, '*')
  }

</script>